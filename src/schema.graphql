schema {
  query: Query
  mutation: Mutation
}

scalar DateTime
scalar JSON

type Query {
  getMovies(limit: Int, title: String, cursor: String, sortBy: String, sortOrder: String): MoviesResult
  getMovieDetails(id: ID!): Movie
  getMovieByTmdbId(tmdbId: String!): GetMovieByTmdbIdResult
  getMoviesByTitle(title: String, limit: Int, cursor: String, sortBy: String, sortOrder: String): MoviesResult
  getRandomBackdropImage: BackdropImage
  getRandomMovieMatchup: Matchup
  checkAuth(token: String): CheckAuth
  getUserDetails(userId: ID!): User
  getUserLeaderboard(cursor: String): LeaderboardResult
  fetchMovieFromTmdb(tmdbId: String!): Movie
  fetchPossibleMovieMatches(title: String!): PossibleMovieMatches
  getImage(tmdbUrl: String!, type: ImageType!, size: String): String
  getImageVariants(tmdbUrl: String!, type: ImageType!): ImageVariants 
  getMovieImage(movieId: ID!, imageType: ImageType!, size: String): String
  getPersonImage(movieId: ID!, personId: ID!, size: String): String
}

type Mutation {
  addMovie(
    title: String!
    releaseDate: String
    overview: String
    genres: [String]
    revenue: String
    posterPath: String
    backdropPath: String
    tmdbId: String
    topBilledCast: [CastMemberInput]
    directors: [DirectorInput]
    tagline: String
    addedBy: ID
    lastUpdated: DateTime
    createdAt: DateTime
    totalWins: Int
    totalLosses: Int
    winningPercentage: Float
    totalComparisons: Int
  ): Movie
  updateMovie(
    id: ID!
    title: String
    releaseDate: String
    overview: String
    genres: [String]
    revenue: String
    posterPath: String
    backdropPath: String
    tmdbId: String
    tagline: String
    topBilledCast: [CastMemberInput]
    directors: [DirectorInput]
    lastUpdated: DateTime
  ): Movie
  deleteMovie(id: ID!): Boolean
  login(emailOrUsername: String!, password: String!): AuthToken
  signup(
    username: String!
    email: String!
    password: String!
    displayName: String
    firstName: String
    lastName: String
    birthday: String
  ): AuthToken
  submitVote(movie1Id: ID!, movie2Id: ID!, winnerId: ID!): VoteResult
  cleanupVotes(userId: ID, movieId: ID, resetAll: Boolean): CleanupResult
  updateProfile(
    id: ID!
    displayName: String
    firstName: String
    lastName: String
    birthday: String
    email: String
    username: String
    avatarUrl: String
  ): User
  
  changePassword(
    id: ID!
    currentPassword: String!
    newPassword: String!
  ): AuthToken
  
  submitFeedback(
    email: String
    comments: String!
    timestamp: DateTime!
  ): FeedbackResult
  
  processImage(tmdbUrl: String!, type: ImageType!): ProcessImageResult
  batchProcessImages(images: [ImageInput!]!): BatchProcessResult
  
  processMovieImages(movieId: ID!): MovieImageProcessResult
  batchProcessMovieImages(limit: Int): BatchMovieImageProcessResult
}

type Movie {
  id: ID
  title: String
  rated: String
  releaseDate: String
  overview: String
  genres: [String]
  revenue: String
  posterPath: String
  backdropPath: String
  posterImages: ImageVariants
  backdropImages: ImageVariants
  castImages: JSON
  crewImages: JSON
  tmdbId: String
  addedBy: ID
  lastUpdated: DateTime
  createdAt: DateTime
  totalWins: Int
  totalLosses: Int
  winningPercentage: Float
  totalComparisons: Int
  tagline: String
  directors: [Director]
  topBilledCast: [CastMember]
}

type MoviesResult {
  searchResults: [Movie]
  newTotalMovieCount: Int
  newCursor: String
  endOfResults: Boolean
}

type PossibleMovieMatch {
  id: ID!
  title: String
  releaseDate: String
  tmdbId: String
  posterPath: String
  backdropPath: String
  overview: String
  genreIds: [Int]
}

type PossibleMovieMatches {
  page: Int
  results: [PossibleMovieMatch]
  totalResults: Int
  totalPages: Int
}

type GetMovieByTmdbIdResult {
  movie: Movie
  found: Boolean!
  errorMessage: String
}

type LeaderboardResult {
  users: [User]
  newTotalUserCount: Int
  newCursor: String
  endOfResults: Boolean
}

type AuthToken {
  token: String!
  user: User!
}

type User {
  id: ID!
  username: String!
  email: String!
  displayName: String
  firstName: String
  lastName: String
  birthday: String
  totalVotes: Int!
  joinDate: String!
  role: String!
  emailVerified: Boolean!
  avatarUrl: String
}

type CheckAuth {
  isValid: Boolean
  message: String
}

type Matchup {
  movie1: Movie!
  movie2: Movie!
  comparisonId: ID
}

type Comparison {
  id: ID!
  movie1Id: ID!
  movie2Id: ID!
  movie1Wins: Int!
  movie2Wins: Int!
  totalVotes: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Vote {
  id: ID!
  userId: ID!
  comparisonId: ID!
  movie1Id: ID!
  movie2Id: ID!
  winnerId: ID!
  timestamp: DateTime!
  sessionId: String
  userAgent: String
}

type Feedback {
  id: ID!
  email: String
  comments: String!
  timestamp: DateTime!
}

type VoteResult {
  success: Boolean!
  message: String
  comparison: Comparison
}

type CleanupResult {
  success: Boolean!
  message: String
  deletedVotes: Int
  affectedUsers: Int
  affectedMovies: Int
}

type FeedbackResult {
  success: Boolean!
  message: String
  feedback: Feedback
}

type BackdropImage {
  backdropPath: String!
}

type Director {
  id: ID!
  name: String!
  profilePath: String
  role: String
}

type CastMember {
  id: ID!
  name: String!
  profilePath: String
  role: String
}

input DirectorInput {
  id: ID!
  name: String!
  profilePath: String
  role: String
}

input CastMemberInput {
  id: ID!
  name: String!
  profilePath: String
  role: String
}

enum ImageType {
  POSTER
  PROFILE
  BACKDROP
}

type ImageVariants {
  w45: String
  w92: String
  w154: String
  w185: String
  w300: String
  w342: String
  w500: String
  w780: String
  w1280: String
  h632: String
  original: String
}

input ImageInput {
  tmdbUrl: String!
  type: ImageType!
  id: String!
}

type ProcessImageResult {
  success: Boolean!
  variants: ImageVariants
  message: String!
}

type BatchProcessResult {
  success: Boolean!
  results: String
  message: String!
}

type MovieImageProcessResult {
  success: Boolean!
  posterImages: ImageVariants
  backdropImages: ImageVariants
  castImages: JSON
  crewImages: JSON
  message: String!
}

type BatchMovieImageProcessResult {
  success: Boolean!
  processed: Int!
  total: Int
  message: String!
}